# Storage Gateway

## Storage Gatewayとは

- オンプレミス（自社環境）からAWSのストレージサービスへのアクセスを高速かつセキュアに行うことができるサービス
- 堅牢性・耐久性に優れたS3をファイル共有ストレージとして利用し、災害対策を目的としたバックアップやアーカイブを行ったり、あまりアクセスされないデータを自社サーバーからAWSへ移動させるなど、様々なケースで利用可能。
- 頻繁に利用するデータは高速なストレージに保存し、反対に利用頻度の低いデータを安価・低速なストレージに配置する（ストレージの階層化と言う）
- 利用頻度に応じて性能の異なるストレージを使い分けることで、コストとパフォーマンスを両立可能。

## 種類

![[Pasted image 20230414073508.png]]

### ファイルゲートウェイ

- オンプレミスから、NFSまたはSMBを介してS3バケットへアクセス可能。オンプレミスにキャッシュストレージを持つため、高速なデータアクセスが可能。  
	- ※NFS（Network File System）、SMB（Server Message Block）： どちらもサーバーなどへ保存されたファイルを複数のクライアントで共有するためのネットワークプロトコル（通信手順）。  

ユーザーごとにアクセスするバケットを制御したい場合はIAMロールで制御することができる

![[Pasted image 20230414073844.png]]

### ボリュームゲートウェイ

- S3をiSCSI接続のブロックストレージボリュームとして提供
	- iSCSI（Internet Small Computer System Interface）とはコンピュータのストレージを接続するSCSIプロトコルをTCP/IPで実現したもののことで、サーバーはiSCSIで接続されたストレージ（Storage Gatewayの場合はS3）をローカルディスクとして使用する。  
- ボリュームストレージ上のデータは任意のタイミングでS3にEBSスナップショットとして保存可能なので、災害対策や定期的なバックアップに利用できる。

#### キャッシュ型（キャッシュボリューム）

- すべてのデータをS3に保存し、高頻度アクセスのデータのみオンプレミスのキャッシュストレージにコピー
- データがキャッシュ上に存在しない場合はS3へアクセスするので遅延が発生するが、オンプレミスのストレージ容量を抑えることができる

![[Pasted image 20230414074146.png]]
  
#### 保管型（ストアドボリューム） 

- すべてのデータをオンプレミスのボリュームストレージに保存し、S3に非同期でバックアップを保存
- キャッシュ型とは異なり全データへのアクセス先がオンプレミスになるので、S3へのアクセスによる遅延が発生しない

![[Pasted image 20230414074235.png]]

### テープゲートウェイ  

- 物理テープストレージの代替として利用できるサービス。VTL（Virtual Tape Library：仮想テープライブラリ）に対応したソフトウェアを介して、S3やGlacierにバックアップデータを保存することができる。  
	- テープ（テープストレージ）とは磁気テープを用いたストレージ。HDDやSSDのようなディスクストレージとは異なり、大容量で安価、かつ長期的なデータ保存に向いているため、アーカイブやバックアップ用途として利用される
- テープゲートウェイを利用することにより、オンプレミスで新規に物理テープを用意したりテープの切り替えを行うなど、テープの操作や管理をする必要がなくなる。また、アーカイブ先としてGlacierとも連携しているため、よりコストを削減可能。

![[Pasted image 20230414074846.png]]


## ユースケース

- ハイブリッドクラウドファイルサービス
- バックアップと災害対策
- アプリケーションデータの移行

ref: https://aws.amazon.com/jp/storagegateway/volume/?nc=sn&loc=2&dn=4#:~:text=%E3%83%A6%E3%83%BC%E3%82%B9%E3%82%B1%E3%83%BC%E3%82%B9