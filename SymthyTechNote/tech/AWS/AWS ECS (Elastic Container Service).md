
## ECS とは

- コンテナを実行、管理するサービス
	- 「コンテナ」とはアプリケーションと実行環境をパッケージ化する仮想化技術の一種
	- ECSのようなコンテナを管理する仕組みを「コンテナオーケストレーション」

![[Pasted image 20230413161347.png]]

## ECS の主要要素


- クラスター  
	- 1つ以上のタスクまたはサービスで構成される論理グループ
	- クラスターでは、コンテナが動作するVPCやサブネットなどを設定する  
- サービス  
	- クラスター内で必要なタスク数を維持する機能
	- あるタスクが異常終了して必要なタスク数を下回った場合、サービスが新しいタスクを起動して自動復旧
	- サービスでは、起動するタスクのタスク定義、必要なタスク数、ELBとの連携などを設定する
- タスク  
	- ECSで管理するコンテナの実行単位
	- タスク内のコンテナは、実行するコンテナイメージ、CPUやメモリのスペック、タスクロールなどを定義した「タスク定義」に基づいて起動
	- タスクロールとはコンテナが他のAWSサービスを利用する際に設定するアクセス権限（IAMロール）のこと  


![[Pasted image 20230413161912.png]]


## ECS 起動タイプ

- AWS Fargate（Fargate起動タイプ）  
	- AWS Fargateはコンテナ向けのサーバーレスコンピューティングエンジン
	- コンテナ実行環境のCPUやメモリのスペック、アクセス権限（IAM）などを設定するだけで、サーバーの環境構築や管理をすることなくコンテナを実行できる  
	- Fargateの利用料金は、タスクで指定したCPU/メモリに応じて課金
	- 実行したタスクのリソース使用量に対して料金が発生するため、不定期にタスクが実行されるシステムや、常にタスクが実行可能な状態でなければならないシステムなどに向いている。  
	- Fargateを1年以上継続して利用する場合は「Compute Savings Plans」で契約すると、サービスを割引価格で利用できる。Compute Savings Plansは1年または3年の期間、一定のサービス使用量（1時間あたりの利用料金）を決めて契約することで、通常よりも低料金になる購入オプション
- EC2起動タイプ  
	- EC2起動タイプはユーザーが管理するEC2インスタンス上でコンテナを実行。
	- コンテナを実行するEC2インスタンス、ネットワーク、IAMなどを設定すると、ECSがAWS CloudFormationのスタックを作成および実行して、構築したコンテナ実行環境をECSに登録
	- EC2起動タイプでは通常のインスタンスと同様に、OSやミドルウェアのアップデート、スケーリングなどのサーバー管理をユーザーで実施する必要がある  
	- EC2起動タイプの利用料金は、指定したEC2インスタンスタイプに応じて課金されます。インスタンスの起動時間に対して料金が発生するので、インスタンス起動中に多数のタスクが実行されるシステムなどに向いている

## ECR (Elastic Container Registry)

- Amazon ECRはコンテナイメージを登録・管理するサービス
- ECRに登録されたコンテナイメージをECSが参照し、コンテナ（タスク）を起動可能
- ECRのようにコンテナイメージを登録・管理する仕組みを「コンテナレジストリ」という

#AWS/ECS